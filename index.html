<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Garagem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#2c3e50">
  <link rel="manifest" href="manifest.json">
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
<h1>Garagem</h1>
<div>Pergolado: <span id="pergolado">--</span></div>
<button onclick="cmd({pergolado:'ON'})">Ligar</button>
<button onclick="cmd({pergolado:'OFF'})">Desligar</button>
<script>
const client = mqtt.connect(
  'wss://3e533850c6644a06ac4bf2bfe62a37f3.s1.eu.hivemq.cloud:8884/mqtt',
  { username:'abohrer', password:'30111987Ab' }
);
client.on('connect',()=>client.subscribe('garagem/state'));
client.on('message',(t,m)=>{
  const s=JSON.parse(m.toString());
  document.getElementById('pergolado').innerText=s.pergolado;
});
function cmd(p){client.publish('garagem/command',JSON.stringify(p));}
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js');}
</script>
</body>
</html>